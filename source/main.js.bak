// 语言配置
const i18n = {
  zh: {
    'page.title': '张舰 - 水杉智境工作室创始人 | 前端研发专家'
  },
  en: {
    'page.title': 'Justin Zhang - Founder of Metasequoia AI Studio | Frontend R&D Expert'
  }
};

// 语言切换功能
document.getElementById('zh-btn').addEventListener('click', function () {
  document.querySelectorAll('.zh').forEach(el => el.classList.remove('hidden'));
  document.querySelectorAll('.en').forEach(el => el.classList.add('hidden'));
  this.classList.add('active');
  this.classList.remove('inactive');
  document.getElementById('en-btn').classList.add('inactive');
  document.getElementById('en-btn').classList.remove('active');
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    if (element.tagName === 'TITLE') {
      element.text = i18n['zh'][key];
    }
  });
});

document.getElementById('en-btn').addEventListener('click', function () {
  document.querySelectorAll('.en').forEach(el => el.classList.remove('hidden'));
  document.querySelectorAll('.zh').forEach(el => el.classList.add('hidden'));
  this.classList.add('active');
  this.classList.remove('inactive');
  document.getElementById('zh-btn').classList.add('inactive');
  document.getElementById('zh-btn').classList.remove('active');
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    if (element.tagName === 'TITLE') {
      element.text = i18n['en'][key];
    }
  });
});

// 滚动动画
function checkVisibility() {
  const sections = document.querySelectorAll('.section');
  sections.forEach(section => {
    const sectionTop = section.getBoundingClientRect().top;
    const windowHeight = window.innerHeight;
    if (sectionTop < windowHeight * 0.9) {
      section.classList.add('visible');
    }
  });
}

// 节流函数
function throttle(func, delay) {
  let timer = null;
  return function () {
    if (!timer) {
      func.apply(this, arguments);
      timer = setTimeout(() => {
        timer = null;
      }, delay);
    }
  };
}

// 初始检查
window.addEventListener('load', checkVisibility);
// 滚动时检查，添加节流优化
window.addEventListener('scroll', throttle(checkVisibility, 200));

// 主题切换功能
document.getElementById('theme-toggle').addEventListener('change', function () {
  document.body.classList.toggle('dark-mode');
  localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
});

// 页面加载时读取主题设置
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'dark') {
  document.body.classList.add('dark-mode');
  document.getElementById('theme-toggle').checked = true;
}

// 导航栏滚动效果，添加节流优化
window.addEventListener('scroll', throttle(function () {
  const nav = document.querySelector('nav');
  const navContainer = nav.querySelector('.container');
  if (window.scrollY > 50) {
    navContainer.style.paddingTop = '8px';
    navContainer.style.paddingBottom = '8px';
  } else {
    navContainer.style.paddingTop = '12px';
    navContainer.style.paddingBottom = '12px';
  }
}, 100));